C51 COMPILER V8.06   MAIN                                                                  07/30/2020 14:24:46 PAGE 1   


C51 COMPILER V8.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\output\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\Sources\main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\main.lst) OBJECT(..\out
                    -put\main.obj)

line level    source

   1          #include "main.h"
   2          uchar TimeData[7]={0, 17, 20, 29, 7, 3, 20};//时钟日历暂存数组，秒/分/时，日/月/星期/年
   3          void WriteTimeData(uchar addr) //addr写时钟的地址命令
   4          {
   5   1              uchar i;
   6   1              Write_byte(0x8e,0x00);  //关闭写保护
   7   1              for(i=0;i<7;i++)
   8   1              {       
   9   2                      Write_byte(addr,Data_BCD(TimeData[i]));
  10   2                      addr+=2;
  11   2              }
  12   1              Write_byte(0x8e,0x80);  //开写保护
  13   1      }
  14          void ReadTimeData(uchar addr)
  15          {
  16   1              uchar i;
  17   1              Write_byte(0x8e,0x00);
  18   1              for(i=0;i<7;i++)
  19   1              {
  20   2                      TimeData[i]=Read_byte(addr);
  21   2                      addr+=2;
  22   2              }
  23   1              Write_byte(0x8e,0x80);
  24   1      }
  25          
  26          
  27           void KeyScan()
  28          { 
  29   1              if(S2==0)
  30   1                      delay_ms(10);
  31   1                      if(S2==0)
  32   1                      {
  33   2                              CE=0;                   
  34   2                              Write_cmd(0x38);  //选择16*2显示
  35   2                              Write_cmd(0x0e);  //开显示，开光标,开闪烁
  36   2                              
  37   2                              if(S4==0)
  38   2                              {
  39   3                                              
  40   3                                      Write_byte(0x8e,0x00);
  41   3                                      TimeData[1]=Read_byte(0x49);
  42   3                                      Write_byte(0x8e,0x80);
  43   3                                      if(S4==0)
  44   3                                      {
  45   4                                              TimeData[1]++;
  46   4                                      }
  47   3                              }
  48   2                      }
  49   1                      if(S3==0)
  50   1                      {
  51   2                              CE=1;
  52   2                              Write_byte(0x8e,0x00);  //关闭写保护    
  53   2                              Write_byte(0x49,Data_BCD(TimeData[1]));
  54   2                              Write_byte(0x8e,0x80);  //开写保护
C51 COMPILER V8.06   MAIN                                                                  07/30/2020 14:24:46 PAGE 2   

  55   2                              Write_byte(0x8e,0x00);
  56   2                              TimeData[1]=Read_byte(0x49);
  57   2                              Write_byte(0x8e,0x80);
  58   2                      }  
  59   1      }
  60          void main()
  61          {
  62   1              uint j;
  63   1              uchar H,L,shi,ge;
  64   1              Init_1602();
  65   1              WriteTimeData(DS1302_W_addr);
  66   1              DisplayStr(0,0,"Date:");
  67   1              DisplayStr(0,1,"Time:");
  68   1              Init_DS18B20();           //每次读写之前都要进行初始化
  69   1              Write_DS18B20(0xcc);  //发送跳跃ROM指令
  70   1              Write_DS18B20(0x4e);  //写暂存器指令
  71   1              Write_DS18B20(0x1f);  //TH寄存器
  72   1              Write_DS18B20(0x0f);  //TL寄存器
  73   1              Write_DS18B20(0x7f);  //配置工作在12位模式下
  74   1      /*      Init_1602();
  75   1              Write_DS18B20(0xcc);
  76   1              Write_DS18B20(0x48);   *///将配置好的存到EEPROM中，
  77   1              while(1)
  78   1              {
  79   2                      ReadTimeData(DS1302_R_addr);
  80   2                      KeyScan();
  81   2                      DisplayOneStr(5,0,TimeData[6]);
  82   2                      DisplayChar(7,0,'-');
  83   2                      DisplayOneStr (8,0,TimeData[4]); //月
  84   2                      DisplayChar(10,0,'-');           //-
  85   2                      DisplayOneStr(11,0,TimeData[3]);//日
  86   2                      DisplayChar(13,0,'-');           //-
  87   2                      DisplayOneStr(14,0,TimeData[5]);//星期
  88   2      
  89   2                      DisplayOneStr(5,1,TimeData[2]); //时
  90   2                      DisplayChar(7,1,':');            //：
  91   2                      DisplayOneStr(8,1,TimeData[1]); //分
  92   2                      DisplayChar(10,1,':');           //：
  93   2                      DisplayOneStr(11,1,TimeData[0]);//秒
  94   2      
  95   2                      Init_DS18B20();           //每次读写之前都要进行初始化
  96   2                      Write_DS18B20(0xcc);  //发送跳跃ROM指令
  97   2                      Write_DS18B20(0x44);  //发送温度转换指令
  98   2                      Init_DS18B20();
  99   2                      Write_DS18B20(0xcc);
 100   2                      Write_DS18B20(0xbe);  //读取DS18B20暂存器值
 101   2                      L=Read_DS18B20();
 102   2                      H=Read_DS18B20();
 103   2                      j=H;
 104   2                      j<<=8;
 105   2                      j|=L;
 106   2                      j=j*0.0625*10+0.5;         //分辨率为0.0625
 107   2                      shi=j/100;
 108   2                      ge=j%100/10;
 109   2                      DisplayChar(14,1,shi+'0');
 110   2                      DisplayChar(15,1,ge+'0');
 111   2              }
 112   1      }
 113                          


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V8.06   MAIN                                                                  07/30/2020 14:24:46 PAGE 3   

   CODE SIZE        =    605    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
