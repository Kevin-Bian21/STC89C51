C51 COMPILER V8.06   红_通信                                                              07/19/2020 23:57:22 PAGE 1   


C51 COMPILER V8.06, COMPILATION OF MODULE 红_通信
OBJECT MODULE PLACED IN 红外通信.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 红外通信.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #define uint unsigned int 
   3          #define uchar unsigned char
   4          
   5          uchar IRtime;     //储存检测红外高低电平持续时间
   6          uchar IRcode[4];  //储存解码后的4个字节数据
   7          uchar IRdata[33]; //包含起始码在内的33位数据
   8          bit IRjm_ok;      //解码后4个字节数据接收完成标志位
   9          bit IRok;                 //33位数据接收完成标志
  10          void delay(uint z)
  11          {
  12   1              uint y;
  13   1              for(;z>0;z--)
  14   1              for(y=114;y>0;y--);             
  15   1      }
  16          void time0Init()
  17          {
  18   1              TMOD|=0x02;
  19   1              TH0=TL0=0;
  20   1              EA=1;
  21   1              ET0=1; //允许定时器0溢出中断
  22   1              TR0=1; //启动定时器0
  23   1              IT0=1; //下降沿触发
  24   1              EX0=1; //允许外部中断0中断
  25   1      
  26   1      }
  27          void UARTInit()  //串口波特率初始化
  28          {
  29   1              TMOD|=0x20;
  30   1              TH1=TL1=0xfd;
  31   1              SCON=0x40;      //SM1=1；
  32   1              TR1=1; //启动定时器1
  33   1      }
  34          void IRJieMa()
  35          {
  36   1              uchar i;//i是用于计数处理4个字节
  37   1              uchar j;//j用于计数处理1个字节的8位数据
  38   1              uchar k;//k用于计数处理33次脉宽
  39   1              k = 1;//从第一位脉宽开始处理，丢掉起始码
  40   1              for(i=0;i<4;i++)
  41   1              {
  42   2                      for(j=0;j<8;j++)
  43   2                      {
  44   3                              IRcode[i]>>=1;
  45   3                              if(IRdata[k]>6)   //通过时间判断是0是1
  46   3                                      IRcode[i]|=0x80;
  47   3                              k++;
  48   3                      }
  49   2              }
  50   1              IRjm_ok=1;
  51   1      }
  52                                          
  53          void main()
  54          {
  55   1              uchar i;
C51 COMPILER V8.06   红_通信                                                              07/19/2020 23:57:22 PAGE 2   

  56   1              time0Init();
  57   1              UARTInit();
  58   1              while(1)
  59   1              {
  60   2                      if(IRok)          //判断33位数据是否接受完成
  61   2                      {
  62   3                              IRJieMa();
  63   3                              IRok=0;
  64   3                              if(IRjm_ok)       //判断解码是否完成
  65   3                              {       
  66   4                                      for(i=0;i<4;i++)
  67   4                                      {
  68   5                                              SBUF=IRcode[i];
  69   5                                              delay(1);        //延时一毫秒使数据能够发完 
  70   5                                              if(TI==1)
  71   5                                              TI=0;
  72   5                                      }
  73   4                                      IRjm_ok=0;
  74   4                              }
  75   3                      }
  76   2              }
  77   1      }
  78          
  79          
  80          void time0() interrupt 1         //定时器0溢出中断
  81          {
  82   1              TH0=TL0=0;                               //每中断一次所需时间为256*1.085=277.76us
  83   1              IRtime++;
  84   1      }
  85          
  86          //接收数据，存入33次脉宽
  87          void time1() interrupt 0         //外部中断0中断
  88          {
  89   1              static uchar k;
  90   1              static bit startflag;
  91   1              if(startflag)
  92   1              {
  93   2                      if((IRtime>40)&&(IRtime<55))  //判断起始码的时间在13.5ms左右
  94   2                              k=0;
  95   2                      IRdata[k]=IRtime;
  96   2                      IRtime=0; //计算脉冲时间清0
  97   2                      k++;
  98   2                      if(k==33)
  99   2                      {
 100   3                              k=0;
 101   3                              IRok=1;
 102   3                      }
 103   2              }
 104   1              else
 105   1              {
 106   2                      IRtime=0;
 107   2                      startflag=1;
 108   2              }
 109   1      }
 110          
 111                                          
 112          
 113          
 114          
 115          
 116          
 117          
C51 COMPILER V8.06   红_通信                                                              07/19/2020 23:57:22 PAGE 3   

 118          
 119          
 120          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    231    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
